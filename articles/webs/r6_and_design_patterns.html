<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>R6 and Design Patterns • distr6</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="R6 and Design Patterns">
<meta property="og:description" content="distr6">
<meta property="og:image" content="https://alan-turing-institute.github.io/distr6/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">distr6</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.8.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Basic
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/webs/intro_to_r6.html">Introduction to R6</a>
    </li>
    <li>
      <a href="../../articles/webs/constructing_a_distribution.html">Constructing a Distribution</a>
    </li>
    <li>
      <a href="../../articles/webs/parameters.html">Getting and Setting Parameters</a>
    </li>
    <li>
      <a href="../../articles/webs/statistical_methods.html">Statistical Methods</a>
    </li>
    <li>
      <a href="../../articles/webs/properties_traits.html">Properties and Traits</a>
    </li>
    <li>
      <a href="../../articles/webs/multivariates.html">Multivariate Distributions</a>
    </li>
    <li>
      <a href="../../articles/webs/listing.html">Listing</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Advanced
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/webs/s3_piping.html">S3 and Piping</a>
    </li>
    <li>
      <a href="../../articles/webs/decorators.html">Decorators</a>
    </li>
    <li>
      <a href="../../articles/webs/wrappers.html">Wrappers</a>
    </li>
    <li>
      <a href="../../articles/webs/custom_distributions.html">Custom Distributions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Extension Guidelines
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/webs/preliminaries.html">Preliminaries</a>
    </li>
    <li>
      <a href="../../articles/webs/create_sdistribution.html">Creating an SDistribution</a>
    </li>
    <li>
      <a href="../../articles/webs/create_kernel.html">Creating a Kernel</a>
    </li>
    <li>
      <a href="../../articles/webs/create_decorator.html">Creating a Decorator</a>
    </li>
    <li>
      <a href="../../articles/webs/create_wrapper.html">Creating a Wrapper</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Appendices
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://raphaels1.github.io/pdfs/distr6Cheatsheet.pdf" class="external-link">Cheatsheet</a>
    </li>
    <li>
      <a href="../../articles/webs/api_lifecycle.html">API Lifecycle</a>
    </li>
    <li>
      <a href="../../articles/webs/analytic_and_numeric_methods.html">Analytical and Numerical Methods</a>
    </li>
    <li>
      <a href="../../articles/webs/r6_and_design_patterns.html">R6 and Design Patterns</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../reference/">Reference</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/RaphaelS1/distr6" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>R6 and Design Patterns</h1>
            
            <h4 data-toc-skip class="date">2023-10-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/alan-turing-institute/distr6/blob/HEAD/vignettes/webs/r6_and_design_patterns.rmd" class="external-link"><code>vignettes/webs/r6_and_design_patterns.rmd</code></a></small>
      <div class="hidden name"><code>r6_and_design_patterns.rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="oop-and-design-patterns">OOP and Design Patterns<a class="anchor" aria-label="anchor" href="#oop-and-design-patterns"></a>
</h2>
<div class="section level3">
<h3 id="oop-practices-and-definitions">OOP Practices and Definitions<a class="anchor" aria-label="anchor" href="#oop-practices-and-definitions"></a>
</h3>
<p>Instead of providing a comprehensive glossary of OOP terms (of which
many exist) we instead give a very brief overview of the most common OOP
practices found in R.</p>
<p>Firstly, it should be noted that R is a functional language that
makes use of dispatch and is not primarily for OOP. Functional
programming and dispatch lends it’s hand very naturally to the
<strong>Strategy</strong> and <strong>Visitor</strong> design patterns
(which we will return to later), the first of R’s OOP style
‘sub-languages’, S3, should not be taken for granted therefore as it
provides very powerful workarounds to strict OOP methods.</p>
<p>R’s update to S3, S4, formally introduces the fundamentals of OOP:
encapsulation, abstraction and inheritance. Combined abstraction and
encapsulation refer to only giving the user access to methods and data
that they require and hiding everything else, it is the principle of
minimising the user-interface (UI) and keeping as much uniformity and
efficiency as possible. Inheritance is the process of one class (the
child-class) ‘copying’ methods and variables from another (the
parent-class).</p>
<p>R6 formalises these methods further by clearly defining the notion of
a class and creating methods to construct the class (and thereby
creating an object). R6 also introduces notions of method chaining and
cloning, to allow a chain of methods to be called and removing the need
to re-create and duplicate an object each time). More concretely, if a
user wants to add the variable <code>y</code> to <code>x</code> and save
the result then they would call <code>x = x + y</code> but if
<code>x</code> is an R6 object then the user simply calls
<code>x + y</code>.</p>
<p>Finally, an <strong>abstract</strong> class is defined as a class
that cannot be constructed, i.e. an object or instance of the class
cannot be created. The purpose of an abstract class is to have multiple
child classes all inherit common methods/variables.</p>
</div>
<div class="section level3">
<h3 id="design-patterns">Design Patterns<a class="anchor" aria-label="anchor" href="#design-patterns"></a>
</h3>
<p>Design Patterns were collated, formalised and introduced in the
seminal Design Patterns book (Gamma et al.) and the authors are commonly
referred to as the Gang of Four (GoF) <span class="citation">(Gamma et
al. 1994)</span>.</p>
<p>By far the most common design patterns in R toolboxes are the
<strong>strategy</strong> and <strong>visitor</strong> design patterns.
From GoF:</p>
<ul>
<li>The <strong>strategy</strong> pattern is a behavioural pattern that
“encapsulates a family of algorithms and makes them
interchangeable.”</li>
<li>The <strong>visitor</strong> pattern is a behavioural pattern that
“lets you define a new operation without changing the classes of the
elements on which it operates”</li>
</ul>
<p>Both of these patterns can be achieved via single or multiple
dispatch and the S3 generic system is essentially a work-around for both
of them. In many toolboxes, the concept of ‘wrappers’ and ‘composites’
are discussed. This is especially confusing as ‘wrapper’ may refer to
one of two design patterns and ‘composite’ is a pattern in itself. The
term wrapper usually refers to either the <strong>decorator</strong> or
<strong>adapter</strong> design pattern, again from GoF:</p>
<ul>
<li>The <strong>decorator</strong> pattern is a structural pattern that
“attaches additional responsibilities to an object dynamically”</li>
<li>The <strong>adapter</strong> pattern is a structural pattern that
“converts the interface of a class into another interface clients
expect”</li>
<li>The <strong>composite</strong> pattern is a structural pattern that
“composes objects into tree structures to represent part-whole
hierarchies”.</li>
</ul>
<p>The key difference is that <strong>adapters</strong> change the class
interface, <strong>decorators</strong> add methods to the interface and
<strong>composites</strong> allow individuals and their composites to be
treated the same.</p>
</div>
</div>
<div class="section level2">
<h2 id="r6-and-oop">R6 and OOP<a class="anchor" aria-label="anchor" href="#r6-and-oop"></a>
</h2>
<p>Despite R6 becoming more commonplace in R packages, we have found no
documentation of best practices for using R6 and OOP methods and design
patterns. Hence we propose our own R6 snippets and workarounds for
common design patterns and other OOP methods. We have implemented the
following OOP processes and design patterns thus far:</p>
<ol style="list-style-type: decimal">
<li><a href="#abstract-classes">Abstract Classes</a></li>
<li><a href="#decorators">Decorators</a></li>
<li><a href="#Adapters">Adapters</a></li>
</ol>
<div class="section level3">
<h3 id="abstract-classes">Abstract Classes<a class="anchor" aria-label="anchor" href="#abstract-classes"></a>
</h3>
<p>Abstract classes are classes that cannot be instantiated. They are
useful for defining hierarchical structures and inheritance in OOP, as
well as for the <strong>abstract factory</strong> design pattern.</p>
<p>Implementation: In R6, all classes are concrete and by default have
an <code>initialize</code> method for construction. Therefore, to make a
class abstract we overload the <code>initialize</code> method as
follows:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> AbstractClass<span class="sc">$</span><span class="fu">set</span>(<span class="st">"public"</span>,<span class="st">"initialize"</span>,<span class="cf">function</span>(){</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span>   <span class="fu">stop</span>(<span class="fu">paste</span>(RSmisc<span class="sc">::</span><span class="fu">getR6Class</span>(self), <span class="st">"is an abstract class that can't be initialized."</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="sc">+</span> })</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># So on construction</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> AbstractClass<span class="sc">$</span><span class="fu">new</span>()</span></code></pre></div>
<pre><code>Error in .subset2(public_bind_env, "initialize")(...) : 
  AbstractClass is an abstract class that can't be initialized.</code></pre>
<hr>
</div>
<div class="section level3">
<h3 id="decorators">Decorators<a class="anchor" aria-label="anchor" href="#decorators"></a>
</h3>
<p>From Gamma et al.:</p>
<blockquote>
<p>“(Decorators) Attach additional responsibilities to an objects
dynamically. Decorators provide a flexible alternative to subclassing
for extending functionality.”</p>
</blockquote>
<p>Implementation: Decorators are particularly complex in R6 for a
number of reasons. Firstly, inheritance occurs in the class definition
and not object definition, therefore we cannot dynamically choose which
class to inherit from. Secondly, methods and variables should only be
defined before initializing an object and any defined after do not have
access to the object itself (i.e. the ‘self’ and ‘private’ accessors).
And finally there is no simple way to reference one object dynamically
from another without this being hardcoded. Implementation has two key
methods, the first via construction of the class to be decorated and the
second via construction of the decorator assuming an object has already
been instantiated to decorate it.</p>
<p><strong>Method 1)</strong> In the class to decorate we copy every
public method from the decorators of interest to the class and we add
<code>self</code> as an argument to ensure that the decorator methods
have the same access level as ‘standard’ methods.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">decorators</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">decorators</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">methods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">public_methods</span>, <span class="fu"><a href="https://rdrr.io/r/base/get.html" class="external-link">get</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span><span class="op">$</span><span class="va">inherit</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">public_methods</span><span class="op">)</span> <span class="co"># Combines decorator methods and any parent methods</span></span>
<span>      <span class="va">methods</span> <span class="op">&lt;-</span> <span class="va">methods</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">methods</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"initialize"</span>,<span class="st">"clone"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span> <span class="co"># Ensures initialize and clone aren't copied</span></span>
<span>      <span class="va">aself</span> <span class="op">&lt;-</span> <span class="va">self</span></span>
<span>      <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">methods</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">methods</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">methods</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>self<span class="op">=</span><span class="va">aself</span><span class="op">)</span><span class="op">)</span> <span class="co"># Adds self as default to every decorator ensuring access to the object</span></span>
<span>          <span class="fu"><a href="https://rdrr.io/r/base/assign.html" class="external-link">assign</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">methods</span><span class="op">)</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,<span class="va">methods</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span>,envir<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/as.environment.html" class="external-link">as.environment</a></span><span class="op">(</span><span class="va">self</span><span class="op">)</span><span class="op">)</span> <span class="co"># Copies every method from the decorator to the object</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">private</span><span class="op">$</span><span class="va">.decorators</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">decorators</span>,<span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">[[</span><span class="st">"classname"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Here we assume <code>decorators</code> is an argument to the
constructor given as a list naming the decorator classes and that a
private variable called <code>.decorators</code> is a list of decorators
already present in the object.</p>
<p><strong>Method 2)</strong> On construction of a particular decorator,
the original object is overwritten with whichever decorators were
already added and the new decorator that is being constructed. The
decorator object is not saved to local memory.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>DistributionDecorator<span class="sc">$</span><span class="fu">set</span>(<span class="st">"public"</span>,<span class="st">"initialize"</span>,<span class="cf">function</span>(distribution){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">getR6Class</span>(self) <span class="sc">==</span> <span class="st">"DistributionDecorator"</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="fu">getR6Class</span>(self), <span class="st">"is an abstract class that can't be initialized."</span>)) <span class="co"># Defines the Abstract Decorator parent class as abstract.</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  decorators <span class="ot">=</span> distribution<span class="sc">$</span><span class="fu">decorators</span>() <span class="co"># Gets decorator list from object.</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(decorators)){</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    decorators <span class="ot">=</span> <span class="fu">lapply</span>(decorators,get)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  decorators <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(decorators,<span class="fu">get</span>(<span class="fu">getR6Class</span>(self)))) <span class="co"># Combines decorators present in the object with the current decorator to be added.</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">assign</span>(<span class="fu">paste0</span>(<span class="fu">substitute</span>(distribution)), Distribution<span class="sc">$</span><span class="fu">new</span>(distribution)), pos <span class="ot">=</span> .GlobalEnv<span class="er">)</span> <span class="co"># Constructs a new object via Method 1) and assigns this to the environment with the same name as the undecorated object.</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="fu">substitute</span>(distribution),<span class="st">"is now decorated with"</span>,<span class="fu">getR6Class</span>(self),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="adapters">Adapters<a class="anchor" aria-label="anchor" href="#adapters"></a>
</h3>
<p>For the wrappers in distr6, our code is closer to that of an adapter
than decorator pattern as we adapt the interface of an object and in
fact the object class is changed in the process. The implementation of
these in distr6 is quite simple, wrappers are classes inheriting from
<code>Distribution</code> objects that have an additional method that
allows the user to view the internally wrapped models (or
distributions). Each wrapper has two parts to its constructor: the
parent-class method that ensures all parameters are unique, and the
child class method that makes any other changes to the object (usually
by editing its pdf and/or cdf)</p>
<p><strong>Parent Class Constructor</strong></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">DistributionWrapper</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"public"</span>,<span class="st">"initialize"</span>,<span class="kw">function</span><span class="op">(</span><span class="va">distlist</span>, <span class="va">prefixParams</span> <span class="op">=</span> <span class="cn">TRUE</span>,<span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu">getR6Class</span><span class="op">(</span><span class="va">self</span><span class="op">)</span> <span class="op">==</span> <span class="st">"DistributionWrapper"</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu">getR6Class</span><span class="op">(</span><span class="va">self</span><span class="op">)</span>, <span class="st">"is an abstract class that can't be initialized."</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../../reference/testDistributionList.html">assertDistributionList</a></span><span class="op">(</span><span class="va">distlist</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">distlist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="fu">parameters</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">update</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">private</span><span class="op">$</span><span class="va">.wrappedModels</span> <span class="op">&lt;-</span> <span class="va">distlist</span></span>
<span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">prefixParams</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">distlist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="va">params</span> <span class="op">=</span> <span class="va">x</span><span class="op">[[</span><span class="st">"parameters"</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">as.data.table</span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="va">params</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">x</span><span class="op">[[</span><span class="st">"short_name"</span><span class="op">]</span><span class="op">]</span>,<span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">params</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span><span class="op">)</span>,sep<span class="op">=</span><span class="st">"_"</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span>    <span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://xoopR.github.io/param6/reference/as.ParameterSet.html" class="external-link">as.ParameterSet</a></span><span class="op">(</span><span class="va">params</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">distlist</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span></span>
<span>      <span class="va">params</span> <span class="op">&lt;-</span> <span class="va">distlist</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">parameters</span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="kw">else</span></span>
<span>      <span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>,<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">distlist</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="fu">parameters</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">super</span><span class="op">$</span><span class="fu">initialize</span><span class="op">(</span>parameters <span class="op">=</span> <span class="va">params</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><strong>Abridged Child Class Constructor
(TruncatedDistribution)</strong></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">TruncatedDistribution</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"public"</span>,<span class="st">"initialize"</span>,<span class="kw">function</span><span class="op">(</span><span class="va">distribution</span>, <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                                                         <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">pdf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">x1</span> <span class="op">&lt;=</span> <span class="va">self</span><span class="op">$</span><span class="fu">inf</span><span class="op">(</span><span class="op">)</span> <span class="op">|</span> <span class="va">x1</span> <span class="op">&gt;</span> <span class="va">self</span><span class="op">$</span><span class="fu">sup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="kw">else</span></span>
<span>      <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">pdf</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">sup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">inf</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">pdf</span><span class="op">)</span><span class="op">$</span><span class="va">self</span> <span class="op">&lt;-</span> <span class="va">self</span></span>
<span>  <span class="va">cdf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>,<span class="va">...</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">num</span> <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">-</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">inf</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">den</span> <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">sup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">inf</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">num</span><span class="op">/</span><span class="va">den</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">cdf</span><span class="op">)</span><span class="op">$</span><span class="va">self</span> <span class="op">&lt;-</span> <span class="va">self</span></span>
<span></span>
<span>  <span class="va">name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"Truncated"</span>,<span class="va">distribution</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span>  <span class="va">short_name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Truncated"</span>,<span class="va">distribution</span><span class="op">$</span><span class="va">short_name</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">distlist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">distribution</span><span class="op">)</span></span>
<span>  <span class="va">description</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">distribution</span><span class="op">$</span><span class="va">description</span>, <span class="st">" Truncated between "</span>,<span class="va">lower</span>,<span class="st">" and "</span>,<span class="va">upper</span>,<span class="st">"."</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">super</span><span class="op">$</span><span class="fu">initialize</span><span class="op">(</span>distlist <span class="op">=</span> <span class="va">distlist</span>, pdf <span class="op">=</span> <span class="va">pdf</span>, cdf <span class="op">=</span> <span class="va">cdf</span>, name <span class="op">=</span> <span class="va">name</span>,</span>
<span>                   short_name <span class="op">=</span> <span class="va">short_name</span>, support <span class="op">=</span> <span class="va">support</span>,</span>
<span>                   type <span class="op">=</span> <span class="va">distribution</span><span class="op">$</span><span class="fu">type</span><span class="op">(</span><span class="op">)</span>, prefixParams <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                   description <span class="op">=</span> <span class="va">description</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-GoF" class="csl-entry">
Gamma, Erich, Richard Helm, Ralph Johnson, and John Vlissides. 1994.
<span>“Design Patterns: Elements of Reusable Object-Oriented
Software.”</span> Addison-Wesley.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Raphael Sonabend, Franz Kiraly.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'c08037a20302b0f7fe5a1b7060957f04',
    indexName: 'distr6',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
