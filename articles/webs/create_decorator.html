<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating a Decorator • distr6</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Creating a Decorator">
<meta property="og:description" content="distr6">
<meta property="og:image" content="https://xoopr.github.io/distr6/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">distr6</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.8.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Basic
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/webs/intro_to_r6.html">Introduction to R6</a>
    </li>
    <li>
      <a href="../../articles/webs/constructing_a_distribution.html">Constructing a Distribution</a>
    </li>
    <li>
      <a href="../../articles/webs/parameters.html">Getting and Setting Parameters</a>
    </li>
    <li>
      <a href="../../articles/webs/statistical_methods.html">Statistical Methods</a>
    </li>
    <li>
      <a href="../../articles/webs/properties_traits.html">Properties and Traits</a>
    </li>
    <li>
      <a href="../../articles/webs/multivariates.html">Multivariate Distributions</a>
    </li>
    <li>
      <a href="../../articles/webs/listing.html">Listing</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Advanced
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/webs/decorators.html">Decorators</a>
    </li>
    <li>
      <a href="../../articles/webs/wrappers.html">Wrappers</a>
    </li>
    <li>
      <a href="../../articles/webs/custom_distributions.html">Custom Distributions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Appendices
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://raphaels1.github.io/pdfs/distr6Cheatsheet.pdf" class="external-link">Cheatsheet</a>
    </li>
    <li>
      <a href="../../articles/webs/r6_and_design_patterns.html">R6 and Design Patterns</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../reference/">Reference</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/RaphaelS1/distr6" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating a Decorator</h1>
            
            <h4 data-toc-skip class="date">2024-02-23</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/alan-turing-institute/distr6/blob/HEAD/vignettes/webs/create_decorator.rmd" class="external-link"><code>vignettes/webs/create_decorator.rmd</code></a></small>
      <div class="hidden name"><code>create_decorator.rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="distributiondecorator-class">DistributionDecorator Class<a class="anchor" aria-label="anchor" href="#distributiondecorator-class"></a>
</h2>
<p>Implementing your own decorator is the easiest extension you can make
to distr6, the only difficulty arises in determining what should go in
your decorator. If you plan on making a pull-request with a new
decorator to distr6 then we would expect the following:</p>
<ol style="list-style-type: decimal">
<li>A description of your decorator including what problem it solves and
why it is required</li>
<li>A description of methodology including the choice of numerical
methods and a description of any packages depended on including how
their code is written (e.g. have you seen their code, is it in R or C,
are there references).</li>
<li>A decorator that adds at least three methods. We do not want a
clutter of decorators in distr6.</li>
</ol>
<p>The <code>DistributionDecorator</code> class is an abstract class
that doesn’t add any methods or variables, its sole purpose is to define
decorators in an abstract sense as a way to collate them. Decorators
could function as named lists, for example the
<code>CoreStatistics</code> decorator could instead be a list called
‘CoreStatistics’ with each named element being one of the added methods.
However lists provide slightly less flexibility and would need to be
created as the package is loaded, as opposed to a relatively small class
that sits in the package namespace.</p>
</div>
<div class="section level2">
<h2 id="creating-a-decorator">Creating a decorator<a class="anchor" aria-label="anchor" href="#creating-a-decorator"></a>
</h2>
<p>A decorator is just a class, inheriting from
<code>DistributionDecorator</code>, with public methods that are added
to a distribution when decorated. For example, the
<code>CoreStatistics</code> decorator has a definition:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CoreStatistics</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html" class="external-link">R6Class</a></span><span class="op">(</span><span class="st">"CoreStatistics"</span>, inherit <span class="op">=</span> <span class="va">DistributionDecorator</span><span class="op">)</span></span></code></pre></div>
<p>and methods (below are just two, again shortened)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">CoreStatistics</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"public"</span>, <span class="st">"mgf"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">genExp</span><span class="op">(</span>trafo <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">x</span><span class="op">*</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">CoreStatistics</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"public"</span>,<span class="st">"genExp"</span>,<span class="kw">function</span><span class="op">(</span><span class="va">trafo</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">trafo</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">trafo</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/formals.html" class="external-link">formals</a></span><span class="op">(</span><span class="va">trafo</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">alist</a></span><span class="op">(</span>x <span class="op">=</span> <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">.distr6</span><span class="op">$</span><span class="va">message_numeric</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">pdfs</span> <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">pdf</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="va">xs</span> <span class="op">=</span> <span class="fu">trafo</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span>      <span class="va">xs</span><span class="op">[</span><span class="va">pdfs</span><span class="op">==</span><span class="fl">0</span><span class="op">]</span> <span class="op">=</span> <span class="fl">0</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">xs</span> <span class="op">*</span> <span class="va">pdfs</span><span class="op">)</span></span>
<span>    <span class="op">}</span>, lower <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">inf</span><span class="op">(</span><span class="op">)</span>, upper <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">sup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">value</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>We don’t have too many requirements in defining decorators apart from
insisting on using the global ‘.distr6$message_numeric’ string as a
message to tell users that numeric results may not be exact. We use
messages instead of warnings as warnings stack, which quickly becomes
annoying.</p>
<p>Finally, we just want to point you in the direction of useful
<code>Distribution</code> private variables that are rarely used outside
of decorators, as an example take the <code>survival</code> method from
the <code>ExoticStatistics</code> class</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ExoticStatistics</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"public"</span>, <span class="st">"survival"</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>, <span class="va">log.p</span> <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.isCdf</span><span class="op">)</span></span>
<span>    <span class="va">self</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span>x1 <span class="op">=</span> <span class="va">x1</span>, lower.tail <span class="op">=</span> <span class="cn">FALSE</span>, log.p <span class="op">=</span> <span class="va">log.p</span><span class="op">)</span></span>
<span>  <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">.distr6</span><span class="op">$</span><span class="va">message_numeric</span><span class="op">)</span></span>
<span>    <span class="va">surv</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="va">pdf</span>, <span class="va">x1</span>, <span class="va">self</span><span class="op">$</span><span class="fu">sup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">log.p</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">surv</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="kw">else</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">surv</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Note the use of <code>private$.isCdf</code>, this checks to see if
the <code>cdf</code> method is defined in the <code>Distribution</code>.
Remember that every <code>Distribution</code> object always have public
d/p/q/r methods defined but do not necessarily have a private d/p/q/r
method which actually does all the work. Therefore every
<code>Distribution</code> includes flags for whether or not the d/p/q/r
method is defined. To test this yourself, create a custom distribution
object with a pdf only, and see what happens when you call the
<code>cdf</code> method (it will return NULL).</p>
<p>Therefore the use of <code>private$.isCdf</code> tells the decorator
whether it can use analytical results or if numeric integration is
required.</p>
<p>Note: if the user has already decorated their distribution with
<code>FunctionImputation</code> then even if your decorator thinks the
results are analytical, they are not. However this is taken into account
by the printed message in the imputed d/p/q/r methods.</p>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Decorators are simple to implement, just define a new class
inheriting from <code>DistributionDecorator</code>
</li>
<li>Add as many public methods as you want, but remember to include
messages for numerical integration</li>
<li>Make use of the private <code>.isCdf</code>, <code>.isPdf</code>,
<code>.isQuantile</code>, <code>.isRand</code> methods to exploit
analytical results.</li>
</ol>
</div>
<div class="section level2">
<h2 id="extension-guidelines">Extension Guidelines<a class="anchor" aria-label="anchor" href="#extension-guidelines"></a>
</h2>
<ul>
<li><a href="https://alan-turing-institute.github.io/distr6/articles/webs/create_sdistribution.html" class="external-link">SDistribution</a></li>
<li><a href="https://alan-turing-institute.github.io/distr6/articles/webs/create_kernel.html" class="external-link">Kernel</a></li>
<li><a href="https://alan-turing-institute.github.io/distr6/articles/webs/create_wrapper.html" class="external-link">Wrapper</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Raphael Sonabend, Franz Kiraly.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'c08037a20302b0f7fe5a1b7060957f04',
    indexName: 'distr6',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
