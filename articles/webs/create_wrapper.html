<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Creating a Wrapper • distr6</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/spacelab/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Creating a Wrapper">
<meta property="og:description" content="distr6">
<meta property="og:image" content="https://alan-turing-institute.github.io/distr6/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">distr6</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.5.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Basic
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/webs/intro_to_r6.html">Introduction to R6</a>
    </li>
    <li>
      <a href="../../articles/webs/constructing_a_distribution.html">Constructing a Distribution</a>
    </li>
    <li>
      <a href="../../articles/webs/parameters.html">Getting and Setting Parameters</a>
    </li>
    <li>
      <a href="../../articles/webs/statistical_methods.html">Statistical Methods</a>
    </li>
    <li>
      <a href="../../articles/webs/properties_traits.html">Properties and Traits</a>
    </li>
    <li>
      <a href="../../articles/webs/multivariates.html">Multivariate Distributions</a>
    </li>
    <li>
      <a href="../../articles/webs/listing.html">Listing</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Advanced
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/webs/s3_piping.html">S3 and Piping</a>
    </li>
    <li>
      <a href="../../articles/webs/decorators.html">Decorators</a>
    </li>
    <li>
      <a href="../../articles/webs/wrappers.html">Wrappers</a>
    </li>
    <li>
      <a href="../../articles/webs/custom_distributions.html">Custom Distributions</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Extension Guidelines
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/webs/preliminaries.html">Preliminaries</a>
    </li>
    <li>
      <a href="../../articles/webs/create_sdistribution.html">Creating an SDistribution</a>
    </li>
    <li>
      <a href="../../articles/webs/create_kernel.html">Creating a Kernel</a>
    </li>
    <li>
      <a href="../../articles/webs/create_decorator.html">Creating a Decorator</a>
    </li>
    <li>
      <a href="../../articles/webs/create_wrapper.html">Creating a Wrapper</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Appendices
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://raphaels1.github.io/pdfs/distr6Cheatsheet.pdf">Cheatsheet</a>
    </li>
    <li>
      <a href="../../articles/webs/api_lifecycle.html">API Lifecycle</a>
    </li>
    <li>
      <a href="../../articles/webs/analytic_and_numeric_methods.html">Analytical and Numerical Methods</a>
    </li>
    <li>
      <a href="../../articles/webs/r6_and_design_patterns.html">R6 and Design Patterns</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../reference/">Reference</a>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
<li>
  <a href="https://github.com/RaphaelS1/distr6">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="create_wrapper_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Creating a Wrapper</h1>
            
            <h4 class="date">2021-05-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/alan-turing-institute/distr6/blob/master/vignettes/webs/create_wrapper.rmd"><code>vignettes/webs/create_wrapper.rmd</code></a></small>
      <div class="hidden name"><code>create_wrapper.rmd</code></div>

    </div>

    
    
<div id="distributionwrapper-class" class="section level2">
<h2 class="hasAnchor">
<a href="#distributionwrapper-class" class="anchor"></a>DistributionWrapper Class</h2>
<p>Wrappers may the hardest class to extend in distr6, simply due to the fact that there are no set rules for what can and can’t go in a wrapper. Every implemented wrapper inherits from the <code>DistributionWrapper</code> class which in turn inherits from <code>Distribution</code> (see the <a href="https://raw.githubusercontent.com/wiki/alan-turing-institute/distr6/images/uml.png">uml diagram</a>). The <code>DistributionWrapper</code> class introduces its own constructor, the <code>wrappedModels</code> method and overloads the <code>setParameterValue</code> method. We will briefly discuss why these three methods are important to all implemented methods.</p>
<div id="the-constructor" class="section level3">
<h3 class="hasAnchor">
<a href="#the-constructor" class="anchor"></a>The Constructor</h3>
<p>The <code>DistributionWrapper</code> constructor takes one named argument and has <code>...</code> for named arguments to passed to the <code>Distribution</code> constructor. The named argument is <code>distlist</code>, a list of distributions to wrap. Internally the constructor combines all <code>ParameterSet</code> from every distribution into one <code>ParameterSet</code> that the user can see and query.</p>
<p>For example, say we use the <code>MixtureDistribution</code> wrapper on two Binomial distributions, see how the parameter names are automatically updated</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span> <span class="op">&lt;-</span> <span class="va"><a href="../../reference/MixtureDistribution.html">MixtureDistribution</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va"><a href="../../reference/Binomial.html">Binomial</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span>,<span class="va"><a href="../../reference/Binomial.html">Binomial</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">M</span><span class="op">$</span><span class="fu">parameters</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;               id   value               support            description</span>
<span class="co">#&gt; 1:  Binom1__prob     0.5                 [0,1] Probability of Success</span>
<span class="co">#&gt; 2: Binom1__qprob     0.5                 [0,1] Probability of failure</span>
<span class="co">#&gt; 3:  Binom1__size      10                    ℕ+       Number of trials</span>
<span class="co">#&gt; 4:  Binom2__prob     0.5                 [0,1] Probability of Success</span>
<span class="co">#&gt; 5: Binom2__qprob     0.5                 [0,1] Probability of failure</span>
<span class="co">#&gt; 6:  Binom2__size      10                    ℕ+       Number of trials</span>
<span class="co">#&gt; 7:  mix__weights uniform ([0,1]^2) ∪ {uniform}        Mixture weights</span></code></pre></div>
</div>
<div id="setparametervalue" class="section level3">
<h3 class="hasAnchor">
<a href="#setparametervalue" class="anchor"></a>setParameterValue</h3>
<p>As the constructor may change the names of parameters, the <code>setParameterValue</code> is overloaded to ensure the correct <code>ParameterSet</code> from the corresponding distribution is updated. So given the example above, if a user wants to update the first Binomial distribution</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span><span class="op">$</span><span class="fu">setParameterValue</span><span class="op">(</span>Binom1__prob <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span></code></pre></div>
<p>And internally the parameter name is split at the underscore and updates the parameter of the first Binomial distribution, notice now that both the external representation of the combined <code>ParameterSet</code> is updated as well as the one in the internal model</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">M</span><span class="op">$</span><span class="fu">parameters</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;               id   value               support            description</span>
<span class="co">#&gt; 1:  Binom1__prob     0.2                 [0,1] Probability of Success</span>
<span class="co">#&gt; 2: Binom1__qprob     0.8                 [0,1] Probability of failure</span>
<span class="co">#&gt; 3:  Binom1__size      10                    ℕ+       Number of trials</span>
<span class="co">#&gt; 4:  Binom2__prob     0.5                 [0,1] Probability of Success</span>
<span class="co">#&gt; 5: Binom2__qprob     0.5                 [0,1] Probability of failure</span>
<span class="co">#&gt; 6:  Binom2__size      10                    ℕ+       Number of trials</span>
<span class="co">#&gt; 7:  mix__weights uniform ([0,1]^2) ∪ {uniform}        Mixture weights</span>
<span class="va">M</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="st">"Binom1"</span><span class="op">)</span><span class="op">$</span><span class="fu">parameters</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;       id value support            description</span>
<span class="co">#&gt; 1:  prob   0.2   [0,1] Probability of Success</span>
<span class="co">#&gt; 2: qprob   0.8   [0,1] Probability of failure</span>
<span class="co">#&gt; 3:  size    10      ℕ+       Number of trials</span></code></pre></div>
</div>
<div id="wrappedmodels" class="section level3">
<h3 class="hasAnchor">
<a href="#wrappedmodels" class="anchor"></a>wrappedModels</h3>
<p>We saw above the use of <code>wrappedModels</code>, this is a simple accessor found in all implemented wrappers that ensure the underlying models can be accessed, which is usually required for the new methods in wrappers, which we will see more below.</p>
</div>
</div>
<div id="creating-a-wrapper" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-wrapper" class="anchor"></a>Creating a Wrapper</h2>
<p>Now we have a background of the <code>DistributionWrapper</code> class we can discuss actually creating a wrapper. As discussed in the <a href="https://alan-turing-institute.github.io/distr6/articles/webs/wrappers.html">wrappers tutorial</a>, there are multiple types of wrappers, each will be implemented slightly differently. Therefore we’re just going to look at one quick example from each example and point you to the source code for further examples.</p>
<div id="truncateddistribution" class="section level3">
<h3 class="hasAnchor">
<a href="#truncateddistribution" class="anchor"></a>TruncatedDistribution</h3>
<p>An implemented wrapper should consist of two parts: the wrapper definition and the wrapper constructor. In the case of the <code>TruncatedDistribution</code>, a slightly abridged version looks like</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TruncatedDistribution</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"TruncatedDistribution"</span>, inherit <span class="op">=</span> <span class="va">DistributionWrapper</span>, lock_objects <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">TruncatedDistribution</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"public"</span>,<span class="st">"initialize"</span>,<span class="kw">function</span><span class="op">(</span><span class="va">distribution</span>, <span class="va">lower</span> <span class="op">=</span> <span class="cn">NULL</span>,
                                                         <span class="va">upper</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">{</span>

  <span class="va">pdf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span>
    <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">pdf</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">sup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">inf</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">cdf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>,<span class="va">...</span><span class="op">)</span><span class="op">{</span>
    <span class="va">num</span> <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span> <span class="op">-</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">inf</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
    <span class="va">den</span> <span class="op">=</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">sup</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="fu">cdf</span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">inf</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">num</span><span class="op">/</span><span class="va">den</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Truncated"</span>,<span class="va">distribution</span><span class="op">$</span><span class="va">name</span><span class="op">)</span>
  <span class="va">short_name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Truncated"</span>,<span class="va">distribution</span><span class="op">$</span><span class="va">short_name</span><span class="op">)</span>

  <span class="va">distlist</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="va">distribution</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">distlist</span><span class="op">)</span> <span class="op">=</span> <span class="va">distribution</span><span class="op">$</span><span class="va">short_name</span>

  <span class="va">description</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="va">distribution</span><span class="op">$</span><span class="va">description</span>, <span class="st">" Truncated between "</span>,<span class="va">lower</span>,<span class="st">" and "</span>,<span class="va">upper</span>,<span class="st">"."</span><span class="op">)</span>

  <span class="va">super</span><span class="op">$</span><span class="fu">initialize</span><span class="op">(</span>distlist <span class="op">=</span> <span class="va">distlist</span>, pdf <span class="op">=</span> <span class="va">pdf</span>, cdf <span class="op">=</span> <span class="va">cdf</span>,
                   name <span class="op">=</span> <span class="va">name</span>, short_name <span class="op">=</span> <span class="va">short_name</span>, support <span class="op">=</span> <span class="va">support</span>,
                   type <span class="op">=</span> <span class="va">distribution</span><span class="op">$</span><span class="fu">type</span><span class="op">(</span><span class="op">)</span>,
                   description <span class="op">=</span> <span class="va">description</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>All wrappers should pass the following to the parent-class constructor:</p>
<ol style="list-style-type: decimal">
<li>Name - New name after wrapping</li>
<li>short_name - New short_name after wrapping</li>
<li>distlist - The named list of distributions (even if just one)</li>
<li>description - Optional, updated description after wrapping</li>
</ol>
<p>And then any other arguments that may be changed by wrapping, remember that any arguments passed to the <code>DistributionWrapper</code> constructor are in turn passed to the <code>Distribution</code> constructor, hence we can think of implemented wrappers as custom distributions. Read the <a href="https://alan-turing-institute.github.io/distr6/articles/webs/custom_distributions.rmd">custom distribution tutorial</a> for more information about the arguments passed to the <code>Distribution</code> constructor.</p>
<p>Notice also that the new <code>pdf</code> and <code>cdf</code> methods reference the original model using the <code>wrappedModels</code> method. This will generally be the case with all wrappers.</p>
</div>
<div id="mixturedistribution" class="section level3">
<h3 class="hasAnchor">
<a href="#mixturedistribution" class="anchor"></a>MixtureDistribution</h3>
<p>The <code>MixtureDistribution</code> wrapper is slightly different in that it takes a composition of multiple distributions and it adds a private variable</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">MixtureDistribution</span> <span class="op">&lt;-</span> <span class="fu">R6</span><span class="fu">::</span><span class="kw"><a href="https://r6.r-lib.org/reference/R6Class.html">R6Class</a></span><span class="op">(</span><span class="st">"MixtureDistribution"</span>, inherit <span class="op">=</span> <span class="va">DistributionWrapper</span>, lock_objects <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">MixtureDistribution</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"public"</span>,<span class="st">"initialize"</span>,<span class="kw">function</span><span class="op">(</span><span class="va">distlist</span>, <span class="va">weights</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">{</span>

  <span class="va">distlist</span> <span class="op">=</span> <span class="fu"><a href="../../reference/makeUniqueDistributions.html">makeUniqueDistributions</a></span><span class="op">(</span><span class="va">distlist</span><span class="op">)</span>
  <span class="va">distnames</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">distlist</span><span class="op">)</span>

  <span class="va">private</span><span class="op">$</span><span class="va">.weights</span> <span class="op">&lt;-</span> <span class="va">weights</span>

  <span class="va">pdf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x1</span>,<span class="va">...</span><span class="op">)</span> <span class="op">{</span>
    <span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="va">y</span><span class="op">$</span><span class="fu">pdf</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">private</span><span class="op">$</span><span class="va">.weights</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
    <span class="kw">else</span>
      <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">self</span><span class="op">$</span><span class="fu">wrappedModels</span><span class="op">(</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="va">y</span><span class="op">$</span><span class="fu">pdf</span><span class="op">(</span><span class="va">x1</span><span class="op">)</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">private</span><span class="op">$</span><span class="va">.weights</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="va">name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Mixture of"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">distnames</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">short_name</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"Mix_"</span>,<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">distnames</span>, collapse <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span><span class="op">)</span>
  <span class="va">type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">setunion</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">distlist</span>, <span class="va">type</span><span class="op">)</span><span class="op">)</span>
  <span class="va">support</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span><span class="op">(</span><span class="va">setunion</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span><span class="op">(</span><span class="va">distlist</span>, <span class="va">type</span><span class="op">)</span><span class="op">)</span>

  <span class="va">super</span><span class="op">$</span><span class="fu">initialize</span><span class="op">(</span>distlist <span class="op">=</span> <span class="va">distlist</span>, pdf <span class="op">=</span> <span class="va">pdf</span>, cdf <span class="op">=</span> <span class="va">cdf</span>, rand <span class="op">=</span> <span class="va">rand</span>, name <span class="op">=</span> <span class="va">name</span>,
                   short_name <span class="op">=</span> <span class="va">short_name</span>, description <span class="op">=</span> <span class="va">description</span>, type <span class="op">=</span> <span class="va">type</span>,
                   support <span class="op">=</span> <span class="va">support</span>, valueSupport <span class="op">=</span> <span class="st">"mixture"</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>
<span class="va">MixtureDistribution</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">"private"</span>,<span class="st">".weights"</span>,<span class="fu"><a href="https://rdrr.io/r/base/numeric.html">numeric</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Again this is a shortened version of the code. Note the following in the above</p>
<ol style="list-style-type: decimal">
<li>As multiple distributions are wrapped we first call <code>makeUniqueDistributions</code>, a helper function that ensures the IDs of the distributions are unique. This automatically clones all distributions passed to it to prevent the R6 copying problem (<a href="https://alan-turing-institute.github.io/distr6/articles/webs/intro_to_r6.html">see here</a>).</li>
<li>We add a private variable <code>.weights</code> which is accessed in the pdf/cdf. In general we allow additional private variables and methods to be added to wrappers, but not public ones.</li>
<li>The type and support are updated to account for multiple distributions.</li>
<li>All implemented wrappers inherit from <code>DistributionWrapper</code> and again <code>lock_objects = FALSE</code>
</li>
</ol>
</div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<ol style="list-style-type: decimal">
<li>Implementing wrappers is similar to implementing a SDistribution or Kernel but generally more flexible</li>
<li>We can add private methods/variables to a wrapper, but if possible, not public methods/variables</li>
<li>Wrappers automatically add methods for accessing internally models and correctly getting/setting parameters</li>
</ol>
</div>
<div id="extension-guidelines" class="section level2">
<h2 class="hasAnchor">
<a href="#extension-guidelines" class="anchor"></a>Extension Guidelines</h2>
<ul>
<li><a href="https://alan-turing-institute.github.io/distr6/articles/webs/create_sdistribution.html">SDistribution</a></li>
<li><a href="https://alan-turing-institute.github.io/distr6/articles/webs/create_kernel.html">Kernel</a></li>
<li><a href="https://alan-turing-institute.github.io/distr6/articles/webs/create_decorator.html">Decorator</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Raphael Sonabend, Franz Kiraly.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'c08037a20302b0f7fe5a1b7060957f04',
    indexName: 'distr6',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
